import pygame
import sys
from random import randint
import os 

# Initialisation de pygame
pygame.init()
L = 1280
H = 720
screen = pygame.display.set_mode((L, H))
clock = pygame.time.Clock()

class Goutte:
    def __init__(self, x, y, vitesse, longueur):
        self.x = x
        self.y = y
        self.vitesse = vitesse
        self.longueur = longueur

    def dessine(self):
        pygame.draw.line(screen, (135, 206, 235), (self.x, self.y), (self.x, self.y + self.longueur), 2)

    def tombe(self):
        self.y += self.vitesse
        if self.y > H:
            self.y = randint(-20, 0)
            self.x = randint(0, L)

class escargot:
    def __init__(self, couleur='red', y=680):
        self.x = 0
        self.y = y
        self.vitesse = 10
        self.couleur = couleur

    def ajoutevitesse(self):
        self.vitesse += 1

    def avance(self):
        self.x += self.vitesse

    def draw(self):
        pygame.draw.rect(screen, self.couleur, (self.x, self.y, 30, 30))


def affiche_victoire(couleur):
    font = pygame.font.SysFont(None, 72)
    texte = font.render(f"Victoire de {couleur} !", True, (255, 255, 255))
    screen.blit(texte, (L//2 - texte.get_width()//2, H//2 - texte.get_height()//2))
    pygame.display.flip()
    pygame.time.wait(10000)  # Attend 10 secondes
    return True

# Création des escargots
listeescargots = [
    escargot(couleur='red', y=680),
    escargot(couleur='green', y=630),
    escargot(couleur='purple', y=580),
    escargot(couleur='pink', y=530)
]

# Initialisation des gouttes de pluie
gouttes = []
for _ in range(100):
    x = randint(0, L)
    y = randint(-H, 0)
    vitesse = randint(5, 15)
    longueur = randint(5, 15)
    gouttes.append(Goutte(x, y, vitesse, longueur))

# Boucle principale
run = True
compteur_pluie = 0
pluie_active = False
prev_keys = pygame.key.get_pressed()

while run:
    for evenement in pygame.event.get():
        if evenement.type == pygame.QUIT:
            run = False

    screen.fill("black")

    victoire = False
    for i, escargot in enumerate(listeescargots):
        escargot.draw()
        if escargot.x >= L - 30:  # Si l'escargot arrive à droite de l'écran
            victoire = affiche_victoire(['red', 'green', 'purple', 'pink'][i])
            if victoire:
                run = False  # Ferme la fenêtre après 10 secondes

    if victoire:
        continue  # On saute le reste de la boucle si victoire

    keys = pygame.key.get_pressed()

    if keys[pygame.K_RIGHT] and not prev_keys[pygame.K_RIGHT]:
        listeescargots[0].avance()

    if keys[pygame.K_LCTRL] and not prev_keys[pygame.K_LCTRL]:
        listeescargots[1].avance()

    if keys[pygame.K_SPACE] and not prev_keys[pygame.K_SPACE]:
        listeescargots[2].avance()

    if keys[pygame.K_RCTRL] and not prev_keys[pygame.K_RCTRL]:
        listeescargots[3].avance()

    prev_keys = keys

    # Incrémente le compteur de pluie
    compteur_pluie += 1
    # Active la pluie après 300 frames
    if compteur_pluie >= 300 and not pluie_active:
        pluie_active = True

    # Si la pluie est active, incrémente le compteur de durée
    if pluie_active:
        compteur_pluie += 1
        if compteur_pluie >= 1000 and pluie_active:
            pluie_active = False
            compteur_pluie = 0

    # Dessine et déplace les gouttes si la pluie est active
    if pluie_active:
        for goutte in gouttes:
            goutte.dessine()
            goutte.tombe()

    pygame.display.flip()
    clock.tick(60)

pygame.quit()
sys.exit()
