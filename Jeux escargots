import pygame
import sys
from random import randint, random
import os

# Initialisation de pygame
pygame.init()
surf = pygame.display.set_mode((1280, 720))
L = 1280
H = 720
screen = pygame.display.set_mode((1280, 720))
clock = pygame.time.Clock()
running = True


class Goutte:
    def __init__(self, x, y, vitesse, longueur):
        self.x = x
        self.y = y
        self.vitesse = vitesse
        self.longueur = longueur

    def dessine(self):
        # Dessine une ligne verticale pour représenter la goutte
        pygame.draw.line(surf, (135, 206, 235), (self.x, self.y), (self.x, self.y + self.longueur), 2)

    def tombe(self):
        # Déplace la goutte vers le bas
        self.y += self.vitesse
        # Si la goutte sort de l'écran, réinitialise sa position en haut
        if self.y > H:
            self.y = randint(-20, 0)
            self.x = randint(0, L)

class escargot:
    def __init__(self,couleur='red',y=680):
        self.x=0
        self.y=y
        self.vitesse=10
        self.couleur=couleur
        
    def ajoutevitesse(self):
        self.vitesse+=1
    
    def avance(self):
        self.x+=self.vitesse
    
    def draw(self):
       pygame.draw.rect(screen, self.couleur, (self.x,self.y,30,30))

# Création des escargots
listeescargots=[]

listeescargots.append(escargot())
listeescargots.append(escargot(couleur='green', y=630))
listeescargots.append(escargot(couleur='purple', y = 580))
listeescargots.append(escargot(couleur='pink', y = 530 ))

# Initialisation des gouttes de pluie
gouttes = []
for _ in range(100):
    x = randint(0, L)
    y = randint(-H, 0)
    vitesse = randint(5, 15)
    longueur = randint(5, 15)
    gouttes.append(Goutte(x, y, vitesse, longueur))

# Boucle principale
run = True
horloge = pygame.time.Clock()
compteur_pluie = 0
pluie_active = False
prev_keys = pygame.key.get_pressed()

while run:
    for evenement in pygame.event.get():
        if evenement.type == pygame.QUIT:
            run = False

    screen.fill("black")


    for i in listeescargots:
        i.draw()
        
    keys = pygame.key.get_pressed()
        
    if keys[pygame.K_RIGHT] and not prev_keys[pygame.K_RIGHT]:
        listeescargots[0].avance()
        
    if keys[pygame.K_LCTRL] and not prev_keys[pygame.K_LCTRL]:
        listeescargots[1].avance()
       
    if keys[pygame.K_SPACE] and not prev_keys[pygame.K_SPACE]:
        listeescargots[2].avance()
        
    if keys[pygame.K_RCTRL] and not prev_keys[pygame.K_RCTRL]:
        listeescargots[3].avance()
            
    prev_keys = keys
    
    # Incrémente le compteur de pluie
    compteur_pluie += 1
    # Active la pluie après 300 frames
    if compteur_pluie >= 300 and not pluie_active:
        pluie_active = True

    # Si la pluie est active, incrémente le compteur de durée
    if pluie_active:
        compteur_pluie += 1
        if compteur_pluie >= 1000 and pluie_active:
            pluie_active = False
            compteur_pluie = 0

    # Dessine et déplace les gouttes si la pluie est active
    if pluie_active:
        for goutte in gouttes:
            goutte.dessine()
            goutte.tombe()


    pygame.display.flip()
    clock.tick(60)

pygame.quit()

    pygame.display.flip()
    horloge.tick(60)
