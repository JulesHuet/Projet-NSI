import pygame
import sys
from random import randint, random
import os

# Initialisation de pygame
pygame.init()
surf = pygame.display.set_mode((1500, 600))
L = 800
H = 600

# En attendant les images 
BLANC = (255, 255, 255)
NOIR = (0, 0, 0)
ROUGE = (255, 0, 0)
BLEU = (0, 0, 255)
VERT = (0, 255, 0)
JAUNE = (255, 255, 0)

count=0
count2=0

class Goutte:
    def __init__(self, x, y, vitesse, longueur):
        self.x = x
        self.y = y
        self.vitesse = vitesse
        self.longueur = longueur

    def dessine(self):
        # Dessine une ligne verticale pour représenter la goutte
        pygame.draw.line(surf, (135, 206, 235), (self.x, self.y), (self.x, self.y + self.longueur), 2)

    def tombe(self):
        # Déplace la goutte vers le bas
        self.y += self.vitesse
        # Si la goutte sort de l'écran, réinitialise sa position en haut
        if self.y > H:
            self.y = randint(-20, 0)
            self.x = randint(0, L)

class Escargot:
    
    keys = pygame.key.get_pressed()
    def __init__(self, nom, couleur, y):
        self.nom = nom # a voir 
        self.couleur = couleur # en fct de l'image a supprimer après 
        self.x = 50
        self.y = y
        self.vitesse = 0
        self.pause_tmps = 1 # LE TEMPS DE PAUSE EN IMAGES (60 ips)
        self.pause_reste = 0 # LE TEMPS PAR DÉFAUT RESTANT POUR LA PAUSE
        self.pause = False # L'ÉTAT DE LA PAUSE

    def avancer(self, keys, prev_keys):
        
        if self.pause: # SI LA PAUSE EST ACTIVE...
            self.pause_reste += 1 # AJOUTER UN NOMBRE A CHAQUE FOIS COMME COMPTE A REBOUS...
            if self.pause_reste >= self.pause_tmps: # JUSQU'A ATTEINDRE LA LIMITE/LE TEMPS VOULU
                self.pause = False # DESACTIVE LA PAUSE
                self.pause_reste = 0 # LE COMPTE A REBOURS DE LA PAUSE EST REMIS A ZERO
            return # POUR ARRÊTER TOUTE ANIMATION
    
        if keys[pygame.K_RIGHT] and not prev_keys[pygame.K_RIGHT]:
            self.x+=10
            self.pause = True

# class Insecte:
#     def __init__(self, x, y, images, vitesse=1):
#         self.x = x
#         self.y = y
#         self.images = images
#         self.vitesse = vitesse
#         self.rect = self.images[0].get_rect(center=(x, y))
#         self.compteur_animation = 0

#     def dessine(self):
#         surf.blit(self.images[self.compteur_animation // 10 % len(self.images)], self.rect)

#     def calcule_futures_parametres(self):
#         self.x += self.vitesse
#         self.rect.center = (int(self.x), int(self.y))
#         if self.x > L + self.rect.width // 2:
#             self.x = -self.rect.width // 2
#         self.compteur_animation += 1

    def dessiner(self, surface): # truc vite fait en attendant les images
        pygame.draw.circle(surface, self.couleur, (self.x, self.y), 20)
        pygame.draw.circle(surface, NOIR, (self.x + 20, self.y - 10), 5)  # Yeux
        font = pygame.font.SysFont(None, 24)
        texte = font.render(self.nom, True, NOIR)
        surface.blit(texte, (self.x - 20, self.y - 30))

# Création des escargots
escargots = [
    Escargot("Rapide", ROUGE, 100),
    Escargot("Turbo", BLEU, 150),
    Escargot("Flash", VERT, 200),
    Escargot("Zoomeur", JAUNE, 250)
]

# Initialisation des gouttes de pluie
gouttes = []
for _ in range(100):
    x = randint(0, L)
    y = randint(-H, 0)
    vitesse = randint(5, 15)
    longueur = randint(5, 15)
    gouttes.append(Goutte(x, y, vitesse, longueur))

# Boucle principale
run = True
horloge = pygame.time.Clock()
font = pygame.font.SysFont(None, 36)
compteur_pluie = 0
pluie_active = False

prev_keys = pygame.key.get_pressed()

while run:
    for evenement in pygame.event.get():
        if evenement.type == pygame.QUIT:
            pygame.quit()
            sys.exit()
        
        # if evenement.type == pygame.KEYDOWN: ne fonctionnes pas 
        #     if evenement.key == pygame.K_1:
        #         escargots[0].vitesse += 1
        #     if evenement.key == pygame.K_2:
        #         escargots[1].vitesse += 1
        #     if evenement.key == pygame.K_3:
        #         escargots[2].vitesse += 1
        #     if evenement.key == pygame.K_4:
        #         escargots[3].vitesse += 1
    
    keys = pygame.key.get_pressed()
    
    # Incrémente le compteur de pluie
    compteur_pluie += 1
    # Active la pluie après 300 frames
    if compteur_pluie >= 300 and not pluie_active:
        pluie_active = True

    # Si la pluie est active, incrémente le compteur de durée
    if pluie_active:
        compteur_pluie += 1
        if compteur_pluie >= 1000 and pluie_active:
            pluie_active = False
            compteur_pluie = 0

    # Dessine et déplace les gouttes si la pluie est active
    if pluie_active:
        for goutte in gouttes:
            goutte.dessine()
            goutte.tombe()

    surf.fill(BLANC)
    for escargot in escargots:
        escargot.avancer(keys, prev_keys)
        escargot.dessiner(surf)

    prev_keys = keys

    pygame.display.flip()
    horloge.tick(60)
